# ---------------------------------------------------------
# @rebwar_ai MacOS
# ---------------------------------------------------------
MCU = atmega2560            # Target microcontroller
F_CPU = 16000000UL          # CPU frequency (16 MHz)
BAUD = 115200               # Baud rate for uploading
PORT = /dev/cu.usbmodem14101 # Example serial port on macOS
SRC = blink.c               # Source file
TARGET = blink              # Output file name (without extension)

# ---------------------------------------------------------
# ‚öôÔ∏è Toolchain Configuration
# ---------------------------------------------------------
CC = avr-gcc
OBJCOPY = avr-objcopy
AVRDUDE = avrdude

# ---------------------------------------------------------
# üèóÔ∏è Compiler Flags
# ---------------------------------------------------------
CFLAGS = -mmcu=$(MCU) -DF_CPU=$(F_CPU) -Os

# ---------------------------------------------------------
# üéØ Default Target
# ---------------------------------------------------------
all: $(TARGET).hex

# ---------------------------------------------------------
# üß© Step 1: Compile and link ‚Üí ELF file
# ---------------------------------------------------------
$(TARGET).elf: $(SRC)
	$(CC) $(CFLAGS) -o $@ $<

# ---------------------------------------------------------
# üß© Step 2: Convert ELF ‚Üí HEX file
# ---------------------------------------------------------
$(TARGET).hex: $(TARGET).elf
	$(OBJCOPY) -O ihex $< $@

# ---------------------------------------------------------
# üöÄ Upload to Arduino Mega 2560
# ---------------------------------------------------------
upload: $(TARGET).hex
	$(AVRDUDE) -D -p $(MCU) -c wiring -P $(PORT) -b $(BAUD) -U flash:w:$<

# ---------------------------------------------------------
# üßπ Clean build files (macOS uses "rm")
# ---------------------------------------------------------
clean:
	rm -f $(TARGET).elf $(TARGET).hex
